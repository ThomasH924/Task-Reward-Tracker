<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Task & Reward Tracker</title>
  <style>
    /* General */
    body {
      font-family: Arial, sans-serif;
      background-color: #FFF9E3;
      color: #5C4033;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    /* Login Screen */
    #login-screen {
      margin-top: 20vh;
    }

    /* Task History */
    #task-history {
      position: fixed;
      left: 0;
      top: 100px;
      width: 200px;
      background-color: #FDEDB2;
      padding: 15px;
      border-radius: 0 10px 10px 0;
      text-align: left;
    }

    #history-list {
      font-size: 14px;
      max-height: 400px;
      overflow-y: auto;
    }

    .history-item {
      margin: 5px 0;
      padding: 5px;
      border-bottom: 1px solid #5C4033;
    }

    /* Main App */
    header {
      background-color: #FDEDB2;
      padding: 20px;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
    }

    #timer {
      font-size: 48px;
      margin: 10px 0;
    }

    /* Buttons */
    button {
      background-color: #5C4033;
      color: #FFF9E3;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #7A523A;
    }

    button.danger {
      background-color: #cc3333;
      margin-top: 20px;
    }

    button.danger:hover {
      background-color: #ff4444;
    }

    /* Sections */
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    section {
      background-color: #FFF3C7;
      margin: 20px;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
    }

    input[type="text"], select {
      padding: 8px;
      margin: 10px;
      border: 2px solid #5C4033;
      border-radius: 8px;
      font-size: 16px;
    }

    /* Reward Items */
    .reward-item {
      margin: 10px 0;
      padding: 10px;
      background: #fff;
      border-radius: 5px;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #ddd;
      border-radius: 5px;
      margin-top: 5px;
    }

    .progress-fill {
      height: 100%;
      background-color: #5C4033;
      border-radius: 5px;
      transition: width 0.3s ease;
    }

    /* Game Section */
    #game-section {
      position: fixed;
      right: 0;
      top: 100px;
      width: 200px;
      background-color: #FDEDB2;
      padding: 15px;
      border-radius: 10px 0 0 10px;
      text-align: center;
    }

    .game-button {
      width: 80%;
      margin: 10px auto;
    }

    #gameCanvas {
      background: #000;
      margin: 10px auto;
    }

    /* Task List */
    #task-list {
      list-style-type: none;
      padding: 0;
    }

    #task-list li {
      margin: 10px 0;
      text-align: left;
    }
  </style>
</head>
<body>
  <div id="login-screen">
    <h1>Welcome!</h1>
    <input type="text" id="nickname-input" placeholder="Enter your nickname">
    <button id="enter-btn">Enter</button>
  </div>

  <div id="main-app" style="display:none;">
    <header>
      <h1>Task & Reward Tracker</h1>
    </header>

    <main>
      <section id="task-history">
        <h2>Task History</h2>
        <div id="history-list"></div>
      </section>
      <section id="tasks">
        <h2>Tasks</h2>
        <input type="text" id="task-input" placeholder="New task...">
        <select id="task-size">
          <option value="small">Small</option>
          <option value="medium">Medium</option>
          <option value="big">Big</option>
        </select>
        <button id="add-task-btn">Add Task</button>
        <ul id="task-list"></ul>
      </section>

      <section id="rewards">
        <h2>Rewards</h2>
        <p>Coins: <span id="coin-count">0</span></p>
        <div id="reward-shop"></div>
        <button id="add-reward-btn">Add Custom Reward</button>
        <button id="reset-btn" class="danger">Reset All Progress</button>
      </section>
      <section id="game-section">
        <button id="play-game-btn" class="game-button">Play Game (2 coins)</button>
        <canvas id="gameCanvas" style="display: none;" width="200" height="300"></canvas>
      </section>
    </main>
  </div>

  <script>
    // JavaScript Code (all merged)
    let coins = 0;
    let tasks = [];
    let rewardList = [];
    let nickname = '';
    let taskHistory = {};

    function loadUserData() {
      const data = localStorage.getItem('productivityData');
      if (data) {
        const parsedData = JSON.parse(data);
        coins = parsedData.coins || 0;
        tasks = parsedData.tasks || [];
        rewardList = parsedData.rewardList || [];
        nickname = parsedData.nickname || '';
        taskHistory = parsedData.taskHistory || {};
        updateUI();
      }
    }

    function updateUI() {
      document.getElementById('coin-count').textContent = coins;
      updateTaskList();
      updateRewardShop();
    }

    function saveUserData() {
      const data = { coins, tasks, rewardList, nickname, taskHistory };
      localStorage.setItem('productivityData', JSON.stringify(data));
    }

    function addTask() {
      const input = document.getElementById('task-input');
      const size = document.getElementById('task-size').value;
      if (input.value.trim()) {
        tasks.push({ text: input.value, size, completed: false });
        input.value = '';
        updateTaskList();
        saveUserData();
      }
    }

    function updateTaskList() {
      const taskList = document.getElementById('task-list');
      taskList.innerHTML = '';
      const sizeOrder = { small: 1, medium: 2, big: 3 };
      tasks.sort((a, b) => sizeOrder[a.size] - sizeOrder[b.size]);
      tasks.forEach((task, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask(${index})">
          <span>${task.text} (${task.size})</span>
          <button onclick="deleteTask(${index})">Delete</button>
        `;
        taskList.appendChild(li);
      });
    }

    function toggleTask(index) {
      tasks[index].completed = !tasks[index].completed;
      if (tasks[index].completed) {
        coins += calculateTaskReward(tasks[index].size);
        document.getElementById('coin-count').textContent = coins;
        const today = new Date().toLocaleDateString();
        taskHistory[today] = (taskHistory[today] || 0) + 1;
        updateTaskHistory();
      }
      saveUserData();
    }

    function updateTaskHistory() {
      const historyList = document.getElementById('history-list');
      historyList.innerHTML = '';
      Object.entries(taskHistory)
        .sort((a, b) => new Date(b[0]) - new Date(a[0]))
        .forEach(([date, count]) => {
          const item = document.createElement('div');
          item.className = 'history-item';
          item.textContent = `${date}: ${count} tasks`;
          historyList.appendChild(item);
        });
    }

    function deleteTask(index) {
      tasks.splice(index, 1);
      updateTaskList();
      saveUserData();
    }

    function calculateTaskReward(size) {
      const rewards = { small: 2, medium: 4, big: 6 };
      return rewards[size] || 2;
    }

    function buyReward(index) {
      const reward = rewardList[index];
      if (coins >= reward.cost) {
        coins -= reward.cost;
        document.getElementById('coin-count').textContent = coins;
        alert(`Enjoy your reward: ${reward.name}!`);
        saveUserData();
      } else {
        alert('Not enough coins!');
      }
    }

    function handleLogin() {
      const nicknameInput = document.getElementById('nickname-input');
      nickname = nicknameInput.value.trim();
      if (nickname) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        saveUserData();
      }
    }

    function updateRewardShop() {
      const rewardShop = document.getElementById('reward-shop');
      rewardShop.innerHTML = '';
      rewardList.sort((a, b) => a.cost - b.cost);
      rewardList.forEach((reward, index) => {
        const progress = Math.min(100, (coins / reward.cost) * 100);
        const div = document.createElement('div');
        div.className = 'reward-item';
        div.innerHTML = `
          <span>${reward.name} - ${reward.cost} coins</span>
          <button onclick="buyReward(${index})">Buy</button>
          <button onclick="deleteReward(${index})">Delete</button>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progress}%"></div>
          </div>
        `;
        rewardShop.appendChild(div);
      });
    }

    function deleteReward(index) {
      if (confirm("Are you sure you want to delete this reward?")) {
        rewardList.splice(index, 1);
        updateRewardShop();
        saveUserData();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadUserData();
      document.getElementById('enter-btn').addEventListener('click', handleLogin);
      document.getElementById('add-task-btn').addEventListener('click', addTask);
      document.getElementById('add-reward-btn').addEventListener('click', () => {
        const name = prompt('Enter reward name:');
        const cost = parseInt(prompt('Enter coin cost:'));
        if (name && !isNaN(cost)) {
          rewardList.push({ name, cost });
          updateRewardShop();
          saveUserData();
        }
      });
      document.getElementById('reset-btn').addEventListener('click', () => {
        if (confirm('Are you sure you want to reset all progress? This cannot be undone!')) {
          coins = 0;
          tasks = [];
          rewardList = [];
          taskHistory = {};
          updateUI();
          updateTaskHistory();
          saveUserData();
        }
      });

      if (nickname) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
      }

      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');
      let gameInterval;
      let paddle = { x: 85, width: 30, height: 10 };
      let ball = { x: 100, y: 150, dx: 2, dy: -2, radius: 5 };
      let gameActive = false;

      function drawGame() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#fff';
        ctx.fillRect(paddle.x, canvas.height - 20, paddle.width, paddle.height);
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#fff';
        ctx.fill();
        ctx.closePath();
        ball.x += ball.dx;
        ball.y += ball.dy;
        if(ball.x + ball.dx > canvas.width - ball.radius || ball.x + ball.dx < ball.radius) ball.dx = -ball.dx;
        if(ball.y + ball.dy < ball.radius) ball.dy = -ball.dy;
        if(ball.y + ball.dy > canvas.height - 20 - ball.radius) {
          if(ball.x > paddle.x && ball.x < paddle.x + paddle.width) ball.dy = -ball.dy;
          else if(ball.y + ball.dy > canvas.height - ball.radius) endGame();
        }
      }

      function endGame() {
        clearInterval(gameInterval);
        gameActive = false;
        canvas.style.display = 'none';
        document.getElementById('play-game-btn').style.display = 'block';
      }

      function startGame() {
        if(coins >= 2) {
          coins -= 2;
          document.getElementById('coin-count').textContent = coins;
          saveUserData();
          ball = { x: 100, y: 150, dx: 2, dy: -2, radius: 5 };
          paddle = { x: 85, width: 30, height: 10 };
          canvas.style.display = 'block';
          document.getElementById('play-game-btn').style.display = 'none';
          gameActive = true;
          gameInterval = setInterval(drawGame, 10);
          setTimeout(endGame, 180000);
        } else {
          alert('Not enough coins! You need 2 coins to play.');
        }
      }

      canvas.addEventListener('mousemove', (e) => {
        if(gameActive) {
          const rect = canvas.getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          paddle.x = Math.min(Math.max(mouseX - paddle.width/2, 0), canvas.width - paddle.width);
        }
      });

      document.getElementById('play-game-btn').addEventListener('click', startGame);
    });
  </script>
</body>
</html>
