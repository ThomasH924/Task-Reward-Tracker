let healthPoints = 0;
let coins = 0;

const healthList = [
  { name: 'Drink Water', hp: 1 },
  { name: 'Eat Breakfast', hp: 3 },
  { name: 'Eat Lunch', hp: 3 },
  { name: 'Eat Dinner', hp: 3 },
  { name: 'Go Outside', hp: 3 },
  { name: 'Exercise', hp: 4 },
  { name: 'Shower', hp: 2 },
  { name: 'Brush Teeth', hp: 1 }
];

const rewardList = [
  { name: '15 Min Screen-Free Break', cost: 10 },
  { name: '25 Min Screen Break', cost: 15 },
  { name: 'Lazy Evening', cost: 50 },
  { name: 'Lazy Weekend', cost: 200 }
];

window.onload = function () {
  renderHealthTasks();
  renderRewards();
};

function updateDisplay() {
  document.getElementById('healthPoints').textContent = healthPoints;
  document.getElementById('coins').textContent = coins;
  const bar = document.getElementById('healthBar');
  bar.style.width = `${Math.min((healthPoints / 20) * 100, 100)}%`;
}

function renderHealthTasks() {
  const container = document.getElementById('healthTasks');
  container.innerHTML = '';
  healthList.forEach(task => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span>${task.name} (+${task.hp} HP)</span>
      <button onclick="completeHealthTask(${task.hp})">Done</button>`;
    container.appendChild(li);
  });
}

function renderRewards() {
  const container = document.getElementById('rewards');
  container.innerHTML = '';
  rewardList.forEach(reward => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span>${reward.name}</span>
      <button onclick="buyReward(${reward.cost})">${reward.cost}ðŸª™</button>`;
    container.appendChild(li);
  });
}

function renderStudyTasks() {
  const container = document.getElementById('studyTasks');
  container.innerHTML = '';
  const tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
  tasks.forEach((task, index) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <input type="checkbox" disabled />
      <span>${task.name}</span>
      <button onclick="unlockTask(${index})">${task.hpCost} HP</button>
      <button onclick="completeStudyTask(${index})">${task.coins}ðŸª™</button>`;
    container.appendChild(li);
  });
}

function completeHealthTask(hp) {
  healthPoints += hp;
  updateDisplay();
}

function buyReward(cost) {
  if (coins >= cost) {
    coins -= cost;
    updateDisplay();
  } else {
    alert('Not enough coins!');
  }
}

function unlockTask(index) {
  const tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
  if (healthPoints >= tasks[index].hpCost) {
    healthPoints -= tasks[index].hpCost;
    tasks[index].unlocked = true;
    localStorage.setItem('studyTasks', JSON.stringify(tasks));
    updateDisplay();
    renderStudyTasks();
  } else {
    alert('Not enough HP!');
  }
}

function completeStudyTask(index) {
  const tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
  if (tasks[index].unlocked) {
    coins += tasks[index].coins;
    tasks.splice(index, 1);
    localStorage.setItem('studyTasks', JSON.stringify(tasks));
    updateDisplay();
    renderStudyTasks();
  }
}

function showPopup(title, callback, withDifficulty = false) {
  const container = document.getElementById('popupContainer');
  container.innerHTML = `
    <div class="modal">
      <div class="modal-content">
        <h2>${title}</h2>
        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
          <input type="text" id="popupInput" placeholder="Name" />
          ${withDifficulty ? `
            <select id="difficultySelect">
              <option value="easy">Small (2 coins / 2 HP)</option>
              <option value="medium">Medium (4 coins / 5 HP)</option>
              <option value="hard">Big (6 coins / 10 HP)</option>
            </select>` : ''
          }
          <button onclick="submitPopup(${callback.name}, ${withDifficulty})">Add</button>
          <button onclick="closePopup()">Cancel</button>
        </div>
      </div>
    </div>
  `;
}

function closePopup() {
  document.getElementById('popupContainer').innerHTML = '';
}

function submitPopup(callbackName, withDifficulty) {
  const name = document.getElementById('popupInput').value;
  if (!name.trim()) return;

  if (withDifficulty) {
    const difficulty = document.getElementById('difficultySelect').value;
    const hpCost = difficulty === 'easy' ? 2 : difficulty === 'medium' ? 5 : 10;
    const coins = difficulty === 'easy' ? 2 : difficulty === 'medium' ? 4 : 6;
    callbackName({ name, hpCost, coins, unlocked: false });
  } else {
    callbackName({ name, hp: 1 });
  }

  closePopup();
}

function addHealthTask(task) {
  healthList.push(task);
  renderHealthTasks();
}

function addStudyTask(task) {
  const tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
  tasks.push(task);
  localStorage.setItem('studyTasks', JSON.stringify(tasks));
  renderStudyTasks();
}

function addReward(reward) {
  rewardList.push({ name: reward.name, cost: reward.coins });
  renderRewards();
}

function resetData() {
  healthPoints = 0;
  coins = 0;
  localStorage.removeItem('studyTasks');
  updateDisplay();
  renderStudyTasks();
}
